<!DOCTYPE html>
<html lang="uz">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SysAdmin Darslar | Tizim Administratorligi</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="/style.css">
    
    <style>
        body {
            background: linear-gradient(135deg, #0a0c10 0%, #111827 100%);
            color: #e5e7eb;
            font-family: 'Inter', sans-serif;
        }
        
        .gradient-text {
            background: linear-gradient(135deg, #8b5cf6 0%, #6366f1 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .navbar {
            background: rgba(10, 12, 16, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #1e293b;
        }
        
        .nav-link {
            color: #9ca3af;
            transition: color 0.3s;
        }
        
        .nav-link:hover,
        .nav-link.active {
            color: #8b5cf6;
        }
        
        .lesson-card {
            background: #111827;
            border: 1px solid #1e293b;
            border-radius: 0.75rem;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .lesson-card:hover {
            border-color: #8b5cf6;
            transform: translateY(-2px);
        }
        
        .lesson-card.active {
            border-left: 4px solid #8b5cf6;
            background: #1e293b;
        }
        
        .badge-beginner {
            background: rgba(34, 197, 94, 0.2);
            color: #4ade80;
        }
        
        .badge-intermediate {
            background: rgba(234, 179, 8, 0.2);
            color: #facc15;
        }
        
        .badge-advanced {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
        }
        
        .badge-expert {
            background: rgba(139, 92, 246, 0.2);
            color: #c084fc;
        }
        
        .code-block {
            background: #0f172a;
            border: 1px solid #1e293b;
            border-radius: 0.75rem;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            color: #4ade80;
            overflow-x: auto;
        }
        
        .loader {
            border: 3px solid #1f2937;
            border-top: 3px solid #8b5cf6;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <!-- Loading overlay -->
    <div id="loading-overlay" class="fixed inset-0 bg-black bg-opacity-80 flex items-center justify-center z-50 hidden">
        <div class="loader"></div>
    </div>
    
    <!-- Navigation -->
    <nav class="navbar">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-2">
                    <i class="fas fa-server text-purple-500 text-2xl"></i>
                    <span class="text-xl font-bold text-white">Sys<span class="text-purple-500">Admin</span></span>
                </div>
                
                <div class="hidden md:flex items-center space-x-6">
                    <a href="/" class="nav-link">Bosh sahifa</a>
                    <a href="/cisco/darslar" class="nav-link">Cisco</a>
                    <a href="/python/darslar" class="nav-link">Python</a>
                    <a href="/sysadmin/darslar" class="nav-link active text-purple-500 border-b-2 border-purple-500">SysAdmin</a>
                    
                    <div class="auth-buttons flex items-center space-x-4">
                        <a href="/login" class="nav-link">Kirish</a>
                        <a href="/register" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg text-sm">Ro'yxatdan o'tish</a>
                    </div>
                    
                    <div class="profile-link hidden flex items-center space-x-4">
                        <button onclick="userAuth.goToProfile()" class="flex items-center space-x-2">
                            <div class="w-8 h-8 bg-purple-600 rounded-full flex items-center justify-center text-sm font-bold user-avatar hidden">U</div>
                            <span class="user-name hidden">Foydalanuvchi</span>
                        </button>
                        <button onclick="userAuth.logout()" class="logout-btn bg-red-600/20 text-red-400 px-4 py-2 rounded-lg text-sm">
                            <i class="fas fa-sign-out-alt mr-2"></i>Chiqish
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Header -->
        <div class="mb-8">
            <h1 class="text-4xl font-bold mb-2">üñ•Ô∏è <span class="gradient-text">Tizim Administratorligi</span></h1>
            <p class="text-gray-400">24 darslik to'liq kurs - Linux, Windows, tarmoq, xavfsizlik va bulut texnologiyalari</p>
        </div>
        
        <!-- Filter tabs -->
        <div class="flex flex-wrap gap-2 mb-6">
            <button class="filter-btn active px-4 py-2 rounded-lg text-sm font-medium bg-purple-600 text-white" data-filter="all">Barcha darslar</button>
            <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 hover:bg-gray-700" data-filter="basic">Boshlang'ich</button>
            <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 hover:bg-gray-700" data-filter="users">Foydalanuvchilar</button>
            <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 hover:bg-gray-700" data-filter="filesystem">Fayl tizimi</button>
            <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 hover:bg-gray-700" data-filter="network">Tarmoq</button>
            <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 hover:bg-gray-700" data-filter="security">Xavfsizlik</button>
            <button class="filter-btn px-4 py-2 rounded-lg text-sm font-medium bg-gray-800 hover:bg-gray-700" data-filter="virtualization">Virtualizatsiya</button>
        </div>
        
        <!-- Progress section -->
        <div class="bg-gray-900 rounded-xl p-6 mb-8">
            <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
                <div>
                    <h2 class="text-lg font-semibold flex items-center">
                        <i class="fas fa-chart-pie text-purple-500 mr-2"></i>
                        Sizning progress
                    </h2>
                    <p class="text-sm text-gray-400">Qaysi darslarni tugatganingizni belgilang</p>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-right">
                        <span id="completed-count" class="text-2xl font-bold text-purple-400">0</span>
                        <span class="text-gray-400">/24</span>
                    </div>
                    <div class="w-48 bg-gray-700 rounded-full h-3">
                        <div id="progress-bar" class="bg-purple-600 h-3 rounded-full" style="width: 0%"></div>
                    </div>
                    <span id="progress-percent" class="text-sm font-medium text-purple-400">0%</span>
                </div>
            </div>
        </div>
        
        <!-- Main grid -->
        <div class="grid grid-cols-1 lg:grid-cols-12 gap-8">
            <!-- Lessons sidebar -->
            <div class="lg:col-span-4 xl:col-span-3">
                <div class="bg-gray-900 rounded-xl p-4 sticky top-20 max-h-[calc(100vh-6rem)] overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="font-semibold flex items-center">
                            <i class="fas fa-list mr-2 text-purple-500"></i>
                            Darslar ro'yxati
                        </h3>
                        <span id="lessons-count" class="text-xs bg-gray-800 px-2 py-1 rounded-full">24 ta</span>
                    </div>
                    
                    <div id="lessons-list" class="space-y-1">
                        <!-- Darslar JS orqali to'ldiriladi -->
                    </div>
                </div>
            </div>
            
            <!-- Content area -->
            <div class="lg:col-span-8 xl:col-span-9">
                <div id="lesson-content" class="bg-gray-900 rounded-xl p-6">
                    <div class="flex items-center justify-center py-20">
                        <div class="loader"></div>
                        <p class="ml-4 text-gray-400">Darslar yuklanmoqda...</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-900 border-t border-gray-800 mt-12 py-8">
        <div class="max-w-7xl mx-auto px-4 text-center text-gray-400">
            ¬© 2024 Tizim Administratorligi kursi
        </div>
    </footer>

    <!-- Scripts -->
    <script src="/middleware.js"></script>
    <script>
        const API_URL = '';
        let darslar = [];
        let activeLessonId = 1;
        let currentFilter = 'all';
        let completedLessons = JSON.parse(localStorage.getItem('sysadmin_completed_lessons')) || [];

        // Darslarni yuklash
        async function loadDarslar() {
            try {
                const response = await fetch('/api/sysadmin/darslar');
                if (!response.ok) throw new Error('API xatolik');
                darslar = await response.json();
                renderLessonsList();
                if (darslar.length > 0) loadLesson(darslar[0].id);
                updateProgress();
            } catch (error) {
                console.error('Xatolik:', error);
                document.getElementById('lesson-content').innerHTML = `
                    <div class="text-center py-10 text-red-400">
                        <i class="fas fa-exclamation-triangle text-4xl mb-3"></i>
                        <p>Darslar yuklanmadi</p>
                        <p class="text-sm text-gray-500 mt-2">${error.message}</p>
                    </div>
                `;
            }
        }

        // Darslar ro'yxatini ko'rsatish
        function renderLessonsList() {
            const container = document.getElementById('lessons-list');
            if (!container) return;
            
            let filtered = darslar;
            if (currentFilter !== 'all') {
                filtered = darslar.filter(d => d.category === currentFilter);
            }
            
            document.getElementById('lessons-count').textContent = filtered.length + ' ta';
            
            if (filtered.length === 0) {
                container.innerHTML = '<div class="text-center py-4 text-gray-500">Darslar topilmadi</div>';
                return;
            }
            
            let html = '';
            filtered.forEach(dars => {
                const isActive = dars.id === activeLessonId;
                const isCompleted = completedLessons.includes(dars.id);
                html += `
                    <div class="lesson-card ${isActive ? 'active' : ''}" data-id="${dars.id}">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="text-2xl">${dars.icon || 'üñ•Ô∏è'}</span>
                                <div>
                                    <div class="font-medium">${dars.id}. ${dars.nomi}</div>
                                    <div class="flex items-center mt-1">
                                        <span class="text-xs ${dars.badge || 'badge-beginner'} px-2 py-0.5 rounded-full">${dars.level || 'Boshlang\'ich'}</span>
                                        ${isCompleted ? '<i class="fas fa-check-circle text-green-500 ml-2"></i>' : ''}
                                    </div>
                                </div>
                            </div>
                            <input type="checkbox" class="lesson-checkbox w-5 h-5 text-purple-600" data-id="${dars.id}" ${isCompleted ? 'checked' : ''}>
                        </div>
                    </div>
                `;
            });
            container.innerHTML = html;
            
            // Event listeners
            document.querySelectorAll('.lesson-card').forEach(card => {
                card.addEventListener('click', (e) => {
                    if (!e.target.classList.contains('lesson-checkbox')) {
                        loadLesson(parseInt(card.dataset.id));
                    }
                });
            });
            
            document.querySelectorAll('.lesson-checkbox').forEach(cb => {
                cb.addEventListener('change', (e) => {
                    e.stopPropagation();
                    const id = parseInt(e.target.dataset.id);
                    const index = completedLessons.indexOf(id);
                    if (index === -1) completedLessons.push(id);
                    else completedLessons.splice(index, 1);
                    localStorage.setItem('sysadmin_completed_lessons', JSON.stringify(completedLessons));
                    updateProgress();
                    renderLessonsList();
                });
            });
        }

        // Dars mazmunini ko'rsatish
        function loadLesson(id) {
            activeLessonId = id;
            const dars = darslar.find(d => d.id === id);
            if (!dars) return;
            
            const isCompleted = completedLessons.includes(id);
            
            const html = `
                <div>
                    <div class="flex items-start justify-between mb-6">
                        <div>
                            <div class="flex items-center space-x-3 mb-2">
                                <span class="text-4xl">${dars.icon || 'üñ•Ô∏è'}</span>
                                <span class="text-xs ${dars.badge || 'badge-beginner'} px-3 py-1 rounded-full">${dars.level || 'Boshlang\'ich'}</span>
                                ${isCompleted ? '<span class="bg-green-500/20 text-green-400 text-xs px-3 py-1 rounded-full"><i class="fas fa-check-circle mr-1"></i>Tugallangan</span>' : ''}
                            </div>
                            <h2 class="text-3xl font-bold">${dars.id}. ${dars.nomi}</h2>
                            <p class="text-gray-400 mt-2">${dars.qisqa_mazmun || ''}</p>
                        </div>
                        
                        <button id="toggle-complete" class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded-lg" data-id="${dars.id}">
                            ${isCompleted ? 'Tugallangan' : 'Darsni tugallash'}
                        </button>
                    </div>
                    
                    <div class="mb-6">${dars.batafsil || ''}</div>
                    
                    <h4 class="font-bold mb-3">üìù Topshiriq:</h4>
                    <div class="bg-gray-800 p-4 rounded-lg mb-6">${dars.topshiriq || ''}</div>
                    
                    <h4 class="font-bold mb-3">‚öôÔ∏è CLI komandalar:</h4>
                    <div class="code-block text-sm">
                        ${(dars.cli_commands || []).map(cmd => `<div>$ ${cmd}</div>`).join('')}
                    </div>
                </div>
            `;
            
            document.getElementById('lesson-content').innerHTML = html;
            
            document.getElementById('toggle-complete')?.addEventListener('click', (e) => {
                const id = parseInt(e.target.dataset.id);
                const index = completedLessons.indexOf(id);
                if (index === -1) completedLessons.push(id);
                else completedLessons.splice(index, 1);
                localStorage.setItem('sysadmin_completed_lessons', JSON.stringify(completedLessons));
                updateProgress();
                loadLesson(id);
                renderLessonsList();
            });
        }

        // Progressni yangilash
        function updateProgress() {
            const total = darslar.length || 24;
            const completed = completedLessons.length;
            const percent = total > 0 ? (completed / total) * 100 : 0;
            
            document.getElementById('completed-count').textContent = completed;
            document.getElementById('progress-bar').style.width = `${percent}%`;
            document.getElementById('progress-percent').textContent = `${Math.round(percent)}%`;
        }

        // Filterlar
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.filter-btn').forEach(b => {
                    b.classList.remove('active', 'bg-purple-600', 'text-white');
                    b.classList.add('bg-gray-800');
                });
                btn.classList.add('active', 'bg-purple-600', 'text-white');
                btn.classList.remove('bg-gray-800');
                currentFilter = btn.dataset.filter;
                renderLessonsList();
            });
        });

        // Sahifa yuklanganda
        document.addEventListener('DOMContentLoaded', loadDarslar);
    </script>
</body>
</html>